import sys
import os
from .. import exploit

def test_exploit_request():
    e = exploit.Exploit(ebd_id='49366')
    request = e.request_exploit_data()
    assert request.status_code == 200
    assert request.encoding == 'UTF-8'
    assert sys.getsizeof(request.content) > 150000


def test_exploit_db_entry():
    e = exploit.Exploit(ebd_id='49371')
    request = e.request_exploit_data()
    entry = e.parse_exploit_data(request)
    print(os.getcwd())
    assert entry['exploit_id'].isdigit()
    if entry['cve_ids']:
        assert 'CVE-' in entry['cve_ids']
    else:
        assert 'cve_ids' in entry
    assert 'created_at' in entry