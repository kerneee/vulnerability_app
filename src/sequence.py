import re
import sys
import os
cmd = ['add cve', 'view cve', 'add exploit', 'view exploit']
sys.path.insert(0, os.path.abspath('..'))
from src.conf import sequences, break_text
from src.handler import Handler



class Sequencer:
    @staticmethod
    def sequence(type='start', mode='default', test_type=None):
        seq = sequences[type]
        print(seq['text'])
        print(break_text)
        user_input = input(seq['input']) if mode == 'default' else test_type
        if mode == 'test':
            return
        if re.match(seq['pattern'], str(user_input)):
            if str(type) in cmd:
                print(user_input, seq['type'], seq['method'])
                Handler(method=seq['method'], typ=seq['type'], value=user_input)
                Sequencer.sequence(type='start')
            Sequencer.sequence(type=user_input)
        else:
            if str(user_input) == 'Start':
                Sequencer.sequence(type='start')
            elif str(user_input) == 'Exit':
                print('Thank you for using. Bye.')
            else:
                error_type = type + "_error"
                print(sequences[error_type]['text'])
                Sequencer.sequence(type=type)


if __name__ == '__main__':
    Sequencer.sequence()